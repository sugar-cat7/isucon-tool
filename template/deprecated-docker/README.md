# 本番でローカル環境を構築する際のテンプレート（仮）を用意する

本番に手間取らないようにdocker関連ファイルのテンプレートを用意しておく  

## 準備

1. `docker-compose.yaml`を`webapp`配下に配置する  

2. `Dockerfile.go`を`webapp/golang`配下に配置する  

3. 環境変数名を書き換える  
追加で定義されている環境変数がある場合はそれも定義する  
webappのポートも確認必須!!  

4. (`Dockerfile.go`のgoのバージョンを合わせる)  
マイナーバージョンの誤差はあまり気にする必要はないと思うのでここはやらなくても動くはず  

これで多分環境構築完了！！！

### 注意!

- 本番はディレクトリ名やファイル名が違う場合があるので気を付けること  

- 外部APIを呼び出していた場合はAPIに依存しない部分はできる限り用意する  
-> N+1の解決などはcurlでAPIを叩いて確認できれば十分のため  

- **30分以上かかるようであれば周りの進捗状況を見ながら手を止めること**

## 起動方法

`webapp`ディレクトリ配下で以下のコマンドを実行  

```bash
docker-compose up --build
```

DBはホストマシンの3306番ポート, APサーバは3000番ポートにマウントするので使用中の場合は現在使用中のプロセスをkillするか`docker-compose.yml`内のホストマシンのポートを変更すること  

```
  ports:
    - "<ホストマシンのポート>:<コンテナのポート>"
```

### SQLサーバにアクセスしたい場合  

以下のコマンド実行後にパスワードを入力  
rootパスワードはroot  

```bash
docker exec mysql mysql -uroot -p
```

### APサーバに接続  

以下のコマンドを実行する  

```bash
docker exec -it webapp bash
```

### APIにリクエストを送る  

```bash
curl http://localhost:3000/<適切なパス名>
```
